<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Lesson Summary</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div class="phone">
    <div class="header">Lesson Summary</div>

    <div class="lesson-info">
        <div class="lesson-name">{{ lesson_name }}</div>
        <div class="lesson-time">{{ lesson_time }}</div>
    </div>

    <div class="section">
        <h3>Classroom Map</h3>
        <div class="classroom">
            <div class="spot green"></div>
            <div class="spot yellow"></div>
            <div class="spot red"></div>
            <div class="spot green"></div>
            <div class="spot yellow"></div>
            <div class="spot green"></div>
        </div>
    </div>

    <div class="tabs">
        <button class="tab active" onclick="openTab('overview')">Overview</button>
        <button class="tab" onclick="openTab('graphs')">Graphs</button>
        <button class="tab" onclick="openTab('suggestions')">Suggestions</button>
    </div>

    <div id="overview" class="tab-content active">
        <div class="overview-cards">
            {% for k, v in overview.items() %}
            <div class="card">
                <div class="card-title">{{ k }}</div>
                <div class="card-value">
                    {{ v }}{% if k.lower() == "attentive students" or k.lower() == "distracted students" %} ({{ (v / overview["Total Students"] * 100)|round(0) }}%) {% endif %}
                </div>
            </div>
            {% endfor %}
            <div class="card">
                <div class="card-title">Average Attention</div>
                <div class="card-value">{{ avg_attention }}%</div>
            </div>
        </div>
    </div>


    <div id="graphs" class="tab-content">
        <div class="attention-value">{{ avg_attention }}%</div>
        <canvas id="attentionTime" width="350" height="150"></canvas>
        <canvas id="attentionPie" width="200" height="200"></canvas>
    </div>

    <div id="suggestions" class="tab-content">
        <ul class="suggestions">
            {% for s in suggestions %}
            <li>{{ s }}</li>
            {% endfor %}
        </ul>
    </div>
</div>

<script>
function openTab(id) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    event.target.classList.add('active');
    document.getElementById(id).classList.add('active');
}

// Line chart for attention over time
const ctxTime = document.getElementById('attentionTime').getContext('2d');
new Chart(ctxTime, {
    type: 'line',
    data: {
        labels: ['0','10','20','30','40','50'],
        datasets: [{
            label: 'Attention %',
            data: {{ attention_time }},
            borderColor: '#7c3aed',
            backgroundColor: 'rgba(124,58,237,0.2)',
            fill: true,
            tension: 0.4
        }]
    },
    options: {
        plugins: { legend: { labels: { color: '#000000' } } },
        scales: {
            x: { ticks: { color: '#000000' } },
            y: { ticks: { color: '#000000' }, suggestedMin: 0, suggestedMax: 100 }
        }
    }
});

// Pie chart for attention distribution
const ctxPie = document.getElementById('attentionPie').getContext('2d');
new Chart(ctxPie, {
    type: 'pie',
    data: {
        labels: [{% for k in attention_distribution.keys() %}'{{ k }}',{% endfor %}],
        datasets: [{
            data: [{% for v in attention_distribution.values() %}{{ v }},{% endfor %}],
            backgroundColor: ['#4c1d95', '#a78bfa', '#e9d5ff']
        }]
    },
    options: {
        plugins: { legend: { labels: { color: '#000000', font: { size: 14 } } } }
    }
});
</script>

</body>
</html>