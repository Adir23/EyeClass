<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>EyeClass</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>

    <div class="phone-frame">
        <header class="app-header">
            <div class="header-row" id="homeHeader">
                <div class="user-greeting">
                    <p>Good Morning,</p>
                    <h1>Sarah</h1>
                </div>
                <div class="avatar">
                    <img src="https://i.pravatar.cc/100?img=5" alt="User">
                </div>
            </div>

            <div class="header-row" id="dashHeader" style="display:none;">
                <div class="user-greeting">
                    <p style="color:var(--status-red); display:flex; align-items:center; gap:6px;">
                        <span style="width:8px; height:8px; background:var(--status-red); border-radius:50%;"></span> LIVE
                    </p>
                    <h1 id="liveSubjectTitle">Math</h1>
                </div>
                <button onclick="endSession()" style="background:white; border:none; width:40px; height:40px; border-radius:50%; color:var(--status-red); display:flex; align-items:center; justify-content:center; box-shadow:0 4px 10px rgba(0,0,0,0.05);">
                    <i data-lucide="power" size="20"></i>
                </button>
            </div>

            <div class="header-row" id="chatHeader" style="display:none; justify-content:center;">
                <div style="text-align:center;">
                    <h1 style="font-size:20px; color:var(--text-main);">Gemini Assistant</h1>
                    <p style="font-size:12px; color:var(--text-secondary);">Online</p>
                </div>
            </div>
        </header>

        <main class="main-content">

            <section id="view-home" class="view-section active">
                <div class="hero-card" id="statusCard">
                    </div>
                <div class="section-header">
                    <span class="section-title">Overview</span>
                    <button class="small-btn"><i data-lucide="bar-chart" size="12"></i> Weekly Analysis</button>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-icon-circle purple"><i data-lucide="trending-up" size="20"></i></div>
                        <span class="stat-val">92%</span>
                        <span class="stat-label">Engagement</span>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon-circle blue"><i data-lucide="clock" size="20"></i></div>
                        <span class="stat-val">14h</span>
                        <span class="stat-label">Tracked</span>
                    </div>
                </div>
                <div class="section-header">
                    <span class="section-title">Recent Sessions</span>
                    <span style="font-size:12px; color:var(--text-secondary);">View All</span>
                </div>
                <div class="recent-list" id="recentSessionList">
                    <div class="session-item" onclick="loadSimulation(1)">
                        <div style="display:flex; align-items:center;">
                            <div class="session-icon"><i data-lucide="calculator"></i></div>
                            <div>
                                <h4 style="margin:0; font-size:15px; color:var(--text-main);">Algebra II</h4>
                                <p style="margin:2px 0 0; font-size:12px; color:var(--text-secondary);">Class 10-A â€¢ 09:30 AM</p>
                            </div>
                        </div>
                        <div style="text-align:right;">
                            <span style="color:var(--status-green); font-weight:800; font-size:15px;">88%</span>
                            <p style="margin:0; font-size:11px; color:#999;">Yesterday</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="view-dashboard" class="view-section">
                <div class="heatmap-container">
                    <div style="width:100%; display:flex; justify-content:space-between; margin-bottom:10px;">
                        <h4 style="color:var(--text-secondary); font-size:14px;">Class Map</h4>
                        <i data-lucide="users" size="16" style="color:var(--accent);"></i>
                    </div>
                    <div class="heatmap-grid" id="classroomGrid"></div>
                </div>
                <div class="graph-card">
                    <h4 style="color:var(--text-secondary); font-size:14px; margin-bottom:10px;">Engagement Trend</h4>
                    <div style="flex:1; width:100%; position:relative;">
                        <canvas id="lineChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <h4 style="color:var(--text-secondary); font-size:14px; margin-bottom:12px;">AI Insights</h4>
                    <div id="aiSuggestionsList" style="display:flex; flex-direction:column; gap:10px;"></div>
                </div>
            </section>

            <section id="view-chat" class="view-section" style="padding-bottom: 100px; display:flex; flex-direction:column;">
                <div class="chat-container" id="chatContainer">
                    <div class="message ai">
                        <div class="avatar-small">
                            <i data-lucide="bot" size="16"></i>
                        </div>
                        <div class="bubble">
                            Hello! I'm your teaching assistant. How can I help you improve the lesson?
                        </div>
                    </div>
                </div>
                <div class="chat-input-wrapper">
                    <textarea id="chatInput" rows="1" placeholder="Ask Gemini..."
                              onkeydown="handleEnter(event)"
                              oninput="autoResize(this)"></textarea>

                    <button class="chat-send-btn" onclick="sendMessage()">
                        <i data-lucide="send" size="18"></i>
                    </button>
                </div>
            </section>

        </main>

        <div class="modal-overlay" id="startModal" onclick="handleOverlayClick(event)">
            <div class="modal-card">
                <div class="modal-handle"></div>
                <h3 style="margin-bottom:5px; font-size:22px; color:var(--text-main);">New Session</h3>
                <p id="currentDateDisplay" style="margin:0 0 20px 0; color:#999; font-size:13px;">Today</p>

                <form onsubmit="handleStart(event)">
                    <div class="input-group">
                        <i data-lucide="book" size="20" style="color:var(--accent);"></i>
                        <select id="inpSubject">
                            <option>Mathematics</option>
                            <option>History</option>
                            <option>Science</option>
                            <option>Physics</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <i data-lucide="users" size="20" style="color:var(--accent);"></i>
                        <select id="inpClass">
                            <option>Class 9-A</option>
                            <option>Class 10-B</option>
                            <option>Class 11-C</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <i data-lucide="type" size="20" style="color:var(--accent);"></i>
                        <input type="text" id="inpTopic" placeholder="Topic (e.g. Algebra)" required>
                    </div>

                    <div class="toggle-row">
                        <div class="toggle-text">
                            <h4>Voice Analysis</h4>
                            <p>Use AI to track pacing & tone</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>

                    <button type="submit" class="primary-btn">Start Monitoring</button>
                </form>
            </div>
        </div>

        <nav class="bottom-nav">
            <button class="nav-item active" onclick="navTo('view-home')">
                <i data-lucide="layout-grid"></i>
                <span>Home</span>
            </button>
            <button class="main-action-btn" id="mainActionBtn" onclick="handleMainAction()">
                <i data-lucide="plus" size="28"></i>
            </button>
            <button class="nav-item" onclick="navTo('view-chat')">
                <i data-lucide="message-square"></i>
                <span>Chat</span>
            </button>
        </nav>

    </div>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
    <script>
        window.initialSessionActive = {{ active_session|tojson }};
        const now = new Date();
        const options = { month: 'short', day: 'numeric', hour: '2-digit', minute:'2-digit' };
        document.getElementById('currentDateDisplay').innerText = "Today, " + now.toLocaleDateString('en-US', options);
    </script>
</body>
</html>