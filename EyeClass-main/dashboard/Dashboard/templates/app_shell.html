<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>EyeClass</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>

    <div class="phone-frame">
        <header class="app-header">
            <div class="header-row" id="homeHeader">
                <div class="user-greeting">
                    <p>Good Morning,</p>
                    <h1>Sarah</h1>
                </div>
                <div class="avatar">
                    <img src="https://i.pravatar.cc/100?img=5" alt="User">
                </div>
            </div>

            <div class="header-row" id="dashHeader" style="display:none;">
                <div class="user-greeting">
                    <p id="liveIndicator" style="color:var(--status-red); display:flex; align-items:center; gap:6px;">
                        <span style="width:8px; height:8px; background:var(--status-red); border-radius:50%;"></span> LIVE
                    </p>
                    <h1 id="liveSubjectTitle">Math</h1>
                </div>
                <button id="powerBtn" onclick="endSession()" style="background:white; border:none; width:40px; height:40px; border-radius:50%; color:var(--status-red); display:flex; align-items:center; justify-content:center; box-shadow:0 4px 10px rgba(0,0,0,0.05);">
                    <i data-lucide="power" size="20"></i>
                </button>
            </div>

            <div class="header-row" id="chatHeader" style="display:none; justify-content:center;">
                <div style="text-align:center;">
                    <h1 style="font-size:20px; color:var(--text-main);">Gemini Assistant</h1>
                    <p style="font-size:12px; color:var(--text-secondary);">Online</p>
                </div>
            </div>
        </header>

        <main class="main-content">

            <section id="view-home" class="view-section active">
                <div class="hero-card" id="statusCard"></div>
                <div class="section-header">
                    <span class="section-title">Overview</span>
                    <button class="small-btn" onclick="navTo('view-weekly')"><i data-lucide="bar-chart" size="12"></i> Weekly Analysis</button>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-icon-circle purple"><i data-lucide="trending-up" size="20"></i></div>
                        <span class="stat-val">92%</span>
                        <span class="stat-label">Engagement</span>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon-circle blue"><i data-lucide="clock" size="20"></i></div>
                        <span class="stat-val">14h</span>
                        <span class="stat-label">Tracked</span>
                    </div>
                </div>
                <div class="section-header">
                    <span class="section-title">Recent Sessions</span>
                    <span style="font-size:12px; color:var(--text-secondary);">View All</span>
                </div>
                <div class="recent-list" id="recentSessionList">
                    <div class="session-item" onclick="loadSimulation(1)">
                        <div style="display:flex; align-items:center;">
                            <div class="session-icon"><i data-lucide="calculator"></i></div>
                            <div>
                                <h4 style="margin:0; font-size:15px; color:var(--text-main);">Algebra II</h4>
                                <p style="margin:2px 0 0; font-size:12px; color:var(--text-secondary);">Class 10-A â€¢ 09:30 AM</p>
                            </div>
                        </div>
                        <div style="text-align:right;">
                            <span style="color:var(--status-green); font-weight:800; font-size:15px;">88%</span>
                            <p style="margin:0; font-size:11px; color:#999;">Yesterday</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="view-dashboard" class="view-section">
                <div class="heatmap-container">
                    <div style="width:100%; display:flex; justify-content:space-between; margin-bottom:10px;">
                        <h4 style="color:var(--text-secondary); font-size:14px;">Class Map</h4>
                        <i data-lucide="users" size="16" style="color:var(--accent);"></i>
                    </div>
                    <div class="heatmap-grid" id="classroomGrid"></div>
                </div>
                <div class="graph-card">
                    <h4 style="color:var(--text-secondary); font-size:14px; margin-bottom:10px;">Engagement Trend</h4>
                    <div style="flex:1; width:100%; position:relative;">
                        <canvas id="lineChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <h4 style="color:var(--text-secondary); font-size:14px; margin-bottom:12px;">AI Insights</h4>
                    <div id="aiSuggestionsList" style="display:flex; flex-direction:column; gap:10px;"></div>
                </div>
            </section>

            <section id="view-chat" class="view-section" style="padding-bottom: 100px; display:flex; flex-direction:column;">
                <div class="chat-container" id="chatContainer">
                    <div class="message ai">
                        <div class="avatar-small"><i data-lucide="bot" size="16"></i></div>
                        <div class="bubble">Hello! I'm your teaching assistant.</div>
                    </div>
                </div>
                <div class="chat-input-wrapper">
                    <textarea id="chatInput" rows="1" placeholder="Ask Gemini..." onkeydown="handleEnter(event)" oninput="autoResize(this)"></textarea>
                    <button class="chat-send-btn" onclick="sendMessage()"><i data-lucide="send" size="18"></i></button>
                </div>
            </section>

            <section id="view-weekly" class="view-section" style="padding: 0; background: var(--bg-app); overflow: hidden; display:flex; flex-direction:column;">

                <div class="weekly-header-container">
                    <div style="display:flex; align-items:center; justify-content:space-between; padding: 20px 20px 0;">
                        <button onclick="navTo('view-home')" style="background:white; border:none; width:40px; height:40px; border-radius:12px; display:flex; align-items:center; justify-content:center; box-shadow:0 2px 5px rgba(0,0,0,0.05); color:var(--text-main);">
                            <i data-lucide="arrow-left" size="20"></i>
                        </button>
                        <h2 style="font-size:18px; color:var(--text-main); font-weight:700;">Weekly Summary</h2>
                        <div style="width:40px;"></div>
                    </div>

                    <div class="omega-wrapper">
                        <svg class="omega-gauge" viewBox="0 0 200 200">
                            <defs>
                                <linearGradient id="gradDirect" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" style="stop-color:#D946EF;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#4F46E5;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <circle class="gauge-bg" cx="100" cy="100" r="80"></circle>
                            <circle class="gauge-fill" id="weeklyProgress" cx="100" cy="100" r="80"></circle>
                        </svg>
                        <div class="omega-text">
                            <span class="omega-score" id="omegaScoreVal">0%</span>
                            <span class="omega-label">Weekly Score</span>
                        </div>
                    </div>

                    <div class="tabs-nav">
                        <button class="tab-btn active" onclick="switchWeeklyTab('tab-overview', this)">Overview</button>
                        <button class="tab-btn" onclick="switchWeeklyTab('tab-graphs', this)">Graphs</button>
                        <button class="tab-btn" onclick="switchWeeklyTab('tab-insights', this)">Insights</button>
                    </div>
                </div>

                <div class="weekly-content" style="flex:1; padding: 20px; overflow-y: auto; padding-bottom: 90px;">

                    <div id="tab-overview" class="tab-pane active">
                        <h4 style="color:var(--text-secondary); font-size:12px; font-weight:700; margin-bottom:12px; text-transform:uppercase; letter-spacing:0.5px;">Performance Metrics</h4>
                        <div class="metrics-grid-2x2">
                            <div class="metric-box">
                                <div class="metric-icon purple"><i data-lucide="clock" size="18"></i></div>
                                <span class="metric-val">18h</span>
                                <span class="metric-lbl">Active Time</span>
                            </div>
                            <div class="metric-box">
                                <div class="metric-icon blue"><i data-lucide="check-circle" size="18"></i></div>
                                <span class="metric-val">24</span>
                                <span class="metric-lbl">Lessons</span>
                            </div>
                            <div class="metric-box">
                                <div class="metric-icon pink"><i data-lucide="users" size="18"></i></div>
                                <span class="metric-val">96%</span>
                                <span class="metric-lbl">Attendance</span>
                            </div>
                            <div class="metric-box">
                                <div class="metric-icon orange"><i data-lucide="zap" size="18"></i></div>
                                <span class="metric-val">High</span>
                                <span class="metric-lbl">Energy</span>
                            </div>
                        </div>
                        <div class="trend-card-gradient">
                            <div class="trend-icon-square">
                                <i data-lucide="trending-up" size="20"></i>
                            </div>
                            <div class="trend-text">
                                <h3>Better than last week</h3>
                                <p>Total engagement +5%</p>
                            </div>
                        </div>
                    </div>

                    <div id="tab-graphs" class="tab-pane" style="display:none; height:100%; min-height: 320px;">

                        <div class="card graph-carousel-card">

                            <div class="carousel-header">
                                <button class="icon-btn" onclick="prevGraph()"><i data-lucide="chevron-left"></i></button>
                                <span class="graph-title" id="carouselTitle">Engagement Trends</span>
                                <button class="icon-btn" onclick="nextGraph()"><i data-lucide="chevron-right"></i></button>
                            </div>

                            <div class="carousel-content">
                                <div class="chart-slide active" id="slide-1">
                                    <canvas id="chart1"></canvas>
                                </div>
                                <div class="chart-slide" id="slide-2">
                                    <canvas id="chart2"></canvas>
                                </div>
                                <div class="chart-slide" id="slide-3">
                                    <canvas id="chart3"></canvas>
                                </div>
                            </div>

                            <div class="carousel-dots">
                                <div class="dot active" id="dot-1"></div>
                                <div class="dot" id="dot-2"></div>
                                <div class="dot" id="dot-3"></div>
                            </div>
                        </div>
                    </div>

                    <div id="tab-insights" class="tab-pane" style="display:none;">
                         <div class="card" style="background:white; border:none; box-shadow:var(--shadow-soft);">
                            <div style="display:flex; gap:12px; margin-bottom:15px;">
                                <div class="avatar-small"><i data-lucide="sparkles" size="18"></i></div>
                                <h4 style="margin:0; align-self:center; color:var(--text-main);">Gemini Analysis</h4>
                            </div>
                            <div id="weekly-ai-content">
                                <p style="color:#94A3B8; font-size:14px;">Generating insights...</p>
                            </div>
                        </div>
                    </div>

                </div>
            </section>

        </main>

        <div class="modal-overlay" id="startModal" onclick="handleOverlayClick(event)">
            <div class="modal-card">
                <div class="modal-handle"></div>
                <h3 style="margin-bottom:5px; font-size:22px; color:var(--text-main);">New Session</h3>
                <p id="currentDateDisplay" style="margin:0 0 20px 0; color:#999; font-size:13px;">Today</p>
                <form onsubmit="handleStart(event)">
                    <div class="input-group"><i data-lucide="book" size="20" style="color:var(--accent);"></i><select id="inpSubject"><option>Mathematics</option><option>History</option><option>Science</option></select></div>
                    <div class="input-group"><i data-lucide="users" size="20" style="color:var(--accent);"></i><select id="inpClass"><option>Class 9-A</option><option>Class 10-B</option></select></div>
                    <div class="input-group"><i data-lucide="type" size="20" style="color:var(--accent);"></i><input type="text" id="inpTopic" placeholder="Topic" required></div>
                    <div class="toggle-row">
                        <div class="toggle-text"><h4>Voice Analysis</h4><p>Use AI to track pacing</p></div>
                        <label class="toggle-switch"><input type="checkbox" checked><span class="slider"></span></label>
                    </div>
                    <button type="submit" class="primary-btn">Start Monitoring</button>
                </form>
            </div>
        </div>

        <nav class="bottom-nav">
            <button class="nav-item active" onclick="navTo('view-home')"><i data-lucide="layout-grid"></i><span>Home</span></button>
            <button class="main-action-btn" id="mainActionBtn" onclick="handleMainAction()"><i data-lucide="plus" size="28"></i></button>
            <button class="nav-item" onclick="navTo('view-chat')"><i data-lucide="message-square"></i><span>Chat</span></button>
        </nav>

    </div>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
    <script>
        window.initialSessionActive = {{ active_session|tojson }};
        const now = new Date();
        document.getElementById('currentDateDisplay').innerText = "Today, " + now.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    </script>
</body>
</html>